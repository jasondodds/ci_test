@isTest
private class RemoteServiceTest {

    @isTest static void test_create_wizard_project() {
        RemoteServices.WizardPayload payload = new RemoteServices.WizardPayload();
        payload.projectName = 'test_create_wizard_project test project name';
        payload.projectDescription = 'test project description';
        payload.namespace = 'test namespace';
        payload.packageName = 'test package name';

        Test.startTest();

        ProjectDefinition__c projectDef = RemoteServices.createWizardProject(JSON.serialize(payload));
        system.assertEquals(1, [select Id from ProjectDefinition__c where Name = :payload.projectName].size());

        Test.stopTest();
    }
	
	@isTest static void test_createRepo() {
        ProjectDefinition__c projectDefinition = TestFactory.factoryProjectDefinition(true);
        String orgResp = '{"id":44111987,"name":"New-Test-Project","full_name":"CodeScience/New-Test-Project","owner":{"login":"CodeScience","id":5943746,"avatar_url":"https://avatars.githubusercontent.com/u/5943746?v=3","gravatar_id":"","url":"https://api.github.com/users/CodeScience","html_url":"https://github.com/CodeScience","followers_url":"https://api.github.com/users/CodeScience/followers","following_url":"https://api.github.com/users/CodeScience/following{/other_user}","gists_url":"https://api.github.com/users/CodeScience/gists{/gist_id}","starred_url":"https://api.github.com/users/CodeScience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CodeScience/subscriptions","organizations_url":"https://api.github.com/users/CodeScience/orgs","repos_url":"https://api.github.com/users/CodeScience/repos","events_url":"https://api.github.com/users/CodeScience/events{/privacy}","received_events_url":"https://api.github.com/users/CodeScience/received_events","type":"Organization","site_admin":false},"private":true,"html_url":"https://github.com/CodeScience/New-Test-Project","description":null,"fork":false,"url":"https://api.github.com/repos/CodeScience/New-Test-Project","forks_url":"https://api.github.com/repos/CodeScience/New-Test-Project/forks","keys_url":"https://api.github.com/repos/CodeScience/New-Test-Project/keys{/key_id}","collaborators_url":"https://api.github.com/repos/CodeScience/New-Test-Project/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/CodeScience/New-Test-Project/teams","hooks_url":"https://api.github.com/repos/CodeScience/New-Test-Project/hooks","issue_events_url":"https://api.github.com/repos/CodeScience/New-Test-Project/issues/events{/number}","events_url":"https://api.github.com/repos/CodeScience/New-Test-Project/events","assignees_url":"https://api.github.com/repos/CodeScience/New-Test-Project/assignees{/user}","branches_url":"https://api.github.com/repos/CodeScience/New-Test-Project/branches{/branch}","tags_url":"https://api.github.com/repos/CodeScience/New-Test-Project/tags","blobs_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/refs{/sha}","trees_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/trees{/sha}","statuses_url":"https://api.github.com/repos/CodeScience/New-Test-Project/statuses/{sha}","languages_url":"https://api.github.com/repos/CodeScience/New-Test-Project/languages","stargazers_url":"https://api.github.com/repos/CodeScience/New-Test-Project/stargazers","contributors_url":"https://api.github.com/repos/CodeScience/New-Test-Project/contributors","subscribers_url":"https://api.github.com/repos/CodeScience/New-Test-Project/subscribers","subscription_url":"https://api.github.com/repos/CodeScience/New-Test-Project/subscription","commits_url":"https://api.github.com/repos/CodeScience/New-Test-Project/commits{/sha}","git_commits_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/commits{/sha}","comments_url":"https://api.github.com/repos/CodeScience/New-Test-Project/comments{/number}","issue_comment_url":"https://api.github.com/repos/CodeScience/New-Test-Project/issues/comments{/number}","contents_url":"https://api.github.com/repos/CodeScience/New-Test-Project/contents/{+path}","compare_url":"https://api.github.com/repos/CodeScience/New-Test-Project/compare/{base}...{head}","merges_url":"https://api.github.com/repos/CodeScience/New-Test-Project/merges","archive_url":"https://api.github.com/repos/CodeScience/New-Test-Project/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/CodeScience/New-Test-Project/downloads","issues_url":"https://api.github.com/repos/CodeScience/New-Test-Project/issues{/number}","pulls_url":"https://api.github.com/repos/CodeScience/New-Test-Project/pulls{/number}","milestones_url":"https://api.github.com/repos/CodeScience/New-Test-Project/milestones{/number}","notifications_url":"https://api.github.com/repos/CodeScience/New-Test-Project/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/CodeScience/New-Test-Project/labels{/name}","releases_url":"https://api.github.com/repos/CodeScience/New-Test-Project/releases{/id}","created_at":"2015-10-12T14:19:50Z","updated_at":"2015-10-12T14:19:50Z","pushed_at":"2015-10-12T14:19:50Z","git_url":"git://github.com/CodeScience/New-Test-Project.git","ssh_url":"git@github.com:CodeScience/New-Test-Project.git","clone_url":"https://github.com/CodeScience/New-Test-Project.git","svn_url":"https://github.com/CodeScience/New-Test-Project","homepage":null,"size":0,"stargazers_count":0,"watchers_count":0,"language":null,"has_issues":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":0,"mirror_url":null,"open_issues_count":0,"forks":0,"open_issues":0,"watchers":0,"default_branch":"master","permissions":{"admin":true,"push":true,"pull":true},"organization":{"login":"CodeScience","id":5943746,"avatar_url":"https://avatars.githubusercontent.com/u/5943746?v=3","gravatar_id":"","url":"https://api.github.com/users/CodeScience","html_url":"https://github.com/CodeScience","followers_url":"https://api.github.com/users/CodeScience/followers","following_url":"https://api.github.com/users/CodeScience/following{/other_user}","gists_url":"https://api.github.com/users/CodeScience/gists{/gist_id}","starred_url":"https://api.github.com/users/CodeScience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CodeScience/subscriptions","organizations_url":"https://api.github.com/users/CodeScience/orgs","repos_url":"https://api.github.com/users/CodeScience/repos","events_url":"https://api.github.com/users/CodeScience/events{/privacy}","received_events_url":"https://api.github.com/users/CodeScience/received_events","type":"Organization","site_admin":false},"network_count":0,"subscribers_count":6}';
        Test.setMock(HttpCalloutMock.class, new GithubCalloutMock(orgResp));
        
        Test.startTest();
        ApexPages.currentPage().getParameters().put('id',projectDefinition.id);
        ApexPages.StandardController stdCtrl = new ApexPages.StandardController(projectDefinition);
        RemoteServices extCtrl = new RemoteServices(stdCtrl);
        String response = RemoteServices.createRepo(projectDefinition.Id);
        System.assert(!response.contains('Exception'), 'An exception should not be thrown');
        Test.stopTest();
    }

    @isTest static void test_updateBuildProps() {
        ProjectDefinition__c projectDefinition = TestFactory.factoryProjectDefinition(true);
        String orgResp = '{"id":44111987,"name":"New-Test-Project","full_name":"CodeScience/New-Test-Project","owner":{"login":"CodeScience","id":5943746,"avatar_url":"https://avatars.githubusercontent.com/u/5943746?v=3","gravatar_id":"","url":"https://api.github.com/users/CodeScience","html_url":"https://github.com/CodeScience","followers_url":"https://api.github.com/users/CodeScience/followers","following_url":"https://api.github.com/users/CodeScience/following{/other_user}","gists_url":"https://api.github.com/users/CodeScience/gists{/gist_id}","starred_url":"https://api.github.com/users/CodeScience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CodeScience/subscriptions","organizations_url":"https://api.github.com/users/CodeScience/orgs","repos_url":"https://api.github.com/users/CodeScience/repos","events_url":"https://api.github.com/users/CodeScience/events{/privacy}","received_events_url":"https://api.github.com/users/CodeScience/received_events","type":"Organization","site_admin":false},"private":true,"html_url":"https://github.com/CodeScience/New-Test-Project","description":null,"fork":false,"url":"https://api.github.com/repos/CodeScience/New-Test-Project","forks_url":"https://api.github.com/repos/CodeScience/New-Test-Project/forks","keys_url":"https://api.github.com/repos/CodeScience/New-Test-Project/keys{/key_id}","collaborators_url":"https://api.github.com/repos/CodeScience/New-Test-Project/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/CodeScience/New-Test-Project/teams","hooks_url":"https://api.github.com/repos/CodeScience/New-Test-Project/hooks","issue_events_url":"https://api.github.com/repos/CodeScience/New-Test-Project/issues/events{/number}","events_url":"https://api.github.com/repos/CodeScience/New-Test-Project/events","assignees_url":"https://api.github.com/repos/CodeScience/New-Test-Project/assignees{/user}","branches_url":"https://api.github.com/repos/CodeScience/New-Test-Project/branches{/branch}","tags_url":"https://api.github.com/repos/CodeScience/New-Test-Project/tags","blobs_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/refs{/sha}","trees_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/trees{/sha}","statuses_url":"https://api.github.com/repos/CodeScience/New-Test-Project/statuses/{sha}","languages_url":"https://api.github.com/repos/CodeScience/New-Test-Project/languages","stargazers_url":"https://api.github.com/repos/CodeScience/New-Test-Project/stargazers","contributors_url":"https://api.github.com/repos/CodeScience/New-Test-Project/contributors","subscribers_url":"https://api.github.com/repos/CodeScience/New-Test-Project/subscribers","subscription_url":"https://api.github.com/repos/CodeScience/New-Test-Project/subscription","commits_url":"https://api.github.com/repos/CodeScience/New-Test-Project/commits{/sha}","git_commits_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/commits{/sha}","comments_url":"https://api.github.com/repos/CodeScience/New-Test-Project/comments{/number}","issue_comment_url":"https://api.github.com/repos/CodeScience/New-Test-Project/issues/comments{/number}","contents_url":"https://api.github.com/repos/CodeScience/New-Test-Project/contents/{+path}","compare_url":"https://api.github.com/repos/CodeScience/New-Test-Project/compare/{base}...{head}","merges_url":"https://api.github.com/repos/CodeScience/New-Test-Project/merges","archive_url":"https://api.github.com/repos/CodeScience/New-Test-Project/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/CodeScience/New-Test-Project/downloads","issues_url":"https://api.github.com/repos/CodeScience/New-Test-Project/issues{/number}","pulls_url":"https://api.github.com/repos/CodeScience/New-Test-Project/pulls{/number}","milestones_url":"https://api.github.com/repos/CodeScience/New-Test-Project/milestones{/number}","notifications_url":"https://api.github.com/repos/CodeScience/New-Test-Project/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/CodeScience/New-Test-Project/labels{/name}","releases_url":"https://api.github.com/repos/CodeScience/New-Test-Project/releases{/id}","created_at":"2015-10-12T14:19:50Z","updated_at":"2015-10-12T14:19:50Z","pushed_at":"2015-10-12T14:19:50Z","git_url":"git://github.com/CodeScience/New-Test-Project.git","ssh_url":"git@github.com:CodeScience/New-Test-Project.git","clone_url":"https://github.com/CodeScience/New-Test-Project.git","svn_url":"https://github.com/CodeScience/New-Test-Project","homepage":null,"size":0,"stargazers_count":0,"watchers_count":0,"language":null,"has_issues":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":0,"mirror_url":null,"open_issues_count":0,"forks":0,"open_issues":0,"watchers":0,"default_branch":"master","permissions":{"admin":true,"push":true,"pull":true},"organization":{"login":"CodeScience","id":5943746,"avatar_url":"https://avatars.githubusercontent.com/u/5943746?v=3","gravatar_id":"","url":"https://api.github.com/users/CodeScience","html_url":"https://github.com/CodeScience","followers_url":"https://api.github.com/users/CodeScience/followers","following_url":"https://api.github.com/users/CodeScience/following{/other_user}","gists_url":"https://api.github.com/users/CodeScience/gists{/gist_id}","starred_url":"https://api.github.com/users/CodeScience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CodeScience/subscriptions","organizations_url":"https://api.github.com/users/CodeScience/orgs","repos_url":"https://api.github.com/users/CodeScience/repos","events_url":"https://api.github.com/users/CodeScience/events{/privacy}","received_events_url":"https://api.github.com/users/CodeScience/received_events","type":"Organization","site_admin":false},"network_count":0,"subscribers_count":6}';
        Test.setMock(HttpCalloutMock.class, new AwsCalloutMock(orgResp));
        
        Test.startTest();
        ApexPages.currentPage().getParameters().put('id',projectDefinition.id);
        ApexPages.StandardController stdCtrl = new ApexPages.StandardController(projectDefinition);
        RemoteServices extCtrl = new RemoteServices(stdCtrl);
        String response = RemoteServices.updateBuildProps(projectDefinition.Id);
        System.assert(!response.contains('Exception'), 'An exception should not be thrown');
        Test.stopTest();
    }

    @isTest static void test_addCircleResources() {
        ProjectDefinition__c projectDefinition = TestFactory.factoryProjectDefinition(true);
        String orgResp = '{"id":44111987,"name":"New-Test-Project","full_name":"CodeScience/New-Test-Project","owner":{"login":"CodeScience","id":5943746,"avatar_url":"https://avatars.githubusercontent.com/u/5943746?v=3","gravatar_id":"","url":"https://api.github.com/users/CodeScience","html_url":"https://github.com/CodeScience","followers_url":"https://api.github.com/users/CodeScience/followers","following_url":"https://api.github.com/users/CodeScience/following{/other_user}","gists_url":"https://api.github.com/users/CodeScience/gists{/gist_id}","starred_url":"https://api.github.com/users/CodeScience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CodeScience/subscriptions","organizations_url":"https://api.github.com/users/CodeScience/orgs","repos_url":"https://api.github.com/users/CodeScience/repos","events_url":"https://api.github.com/users/CodeScience/events{/privacy}","received_events_url":"https://api.github.com/users/CodeScience/received_events","type":"Organization","site_admin":false},"private":true,"html_url":"https://github.com/CodeScience/New-Test-Project","description":null,"fork":false,"url":"https://api.github.com/repos/CodeScience/New-Test-Project","forks_url":"https://api.github.com/repos/CodeScience/New-Test-Project/forks","keys_url":"https://api.github.com/repos/CodeScience/New-Test-Project/keys{/key_id}","collaborators_url":"https://api.github.com/repos/CodeScience/New-Test-Project/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/CodeScience/New-Test-Project/teams","hooks_url":"https://api.github.com/repos/CodeScience/New-Test-Project/hooks","issue_events_url":"https://api.github.com/repos/CodeScience/New-Test-Project/issues/events{/number}","events_url":"https://api.github.com/repos/CodeScience/New-Test-Project/events","assignees_url":"https://api.github.com/repos/CodeScience/New-Test-Project/assignees{/user}","branches_url":"https://api.github.com/repos/CodeScience/New-Test-Project/branches{/branch}","tags_url":"https://api.github.com/repos/CodeScience/New-Test-Project/tags","blobs_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/refs{/sha}","trees_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/trees{/sha}","statuses_url":"https://api.github.com/repos/CodeScience/New-Test-Project/statuses/{sha}","languages_url":"https://api.github.com/repos/CodeScience/New-Test-Project/languages","stargazers_url":"https://api.github.com/repos/CodeScience/New-Test-Project/stargazers","contributors_url":"https://api.github.com/repos/CodeScience/New-Test-Project/contributors","subscribers_url":"https://api.github.com/repos/CodeScience/New-Test-Project/subscribers","subscription_url":"https://api.github.com/repos/CodeScience/New-Test-Project/subscription","commits_url":"https://api.github.com/repos/CodeScience/New-Test-Project/commits{/sha}","git_commits_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/commits{/sha}","comments_url":"https://api.github.com/repos/CodeScience/New-Test-Project/comments{/number}","issue_comment_url":"https://api.github.com/repos/CodeScience/New-Test-Project/issues/comments{/number}","contents_url":"https://api.github.com/repos/CodeScience/New-Test-Project/contents/{+path}","compare_url":"https://api.github.com/repos/CodeScience/New-Test-Project/compare/{base}...{head}","merges_url":"https://api.github.com/repos/CodeScience/New-Test-Project/merges","archive_url":"https://api.github.com/repos/CodeScience/New-Test-Project/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/CodeScience/New-Test-Project/downloads","issues_url":"https://api.github.com/repos/CodeScience/New-Test-Project/issues{/number}","pulls_url":"https://api.github.com/repos/CodeScience/New-Test-Project/pulls{/number}","milestones_url":"https://api.github.com/repos/CodeScience/New-Test-Project/milestones{/number}","notifications_url":"https://api.github.com/repos/CodeScience/New-Test-Project/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/CodeScience/New-Test-Project/labels{/name}","releases_url":"https://api.github.com/repos/CodeScience/New-Test-Project/releases{/id}","created_at":"2015-10-12T14:19:50Z","updated_at":"2015-10-12T14:19:50Z","pushed_at":"2015-10-12T14:19:50Z","git_url":"git://github.com/CodeScience/New-Test-Project.git","ssh_url":"git@github.com:CodeScience/New-Test-Project.git","clone_url":"https://github.com/CodeScience/New-Test-Project.git","svn_url":"https://github.com/CodeScience/New-Test-Project","homepage":null,"size":0,"stargazers_count":0,"watchers_count":0,"language":null,"has_issues":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":0,"mirror_url":null,"open_issues_count":0,"forks":0,"open_issues":0,"watchers":0,"default_branch":"master","permissions":{"admin":true,"push":true,"pull":true},"organization":{"login":"CodeScience","id":5943746,"avatar_url":"https://avatars.githubusercontent.com/u/5943746?v=3","gravatar_id":"","url":"https://api.github.com/users/CodeScience","html_url":"https://github.com/CodeScience","followers_url":"https://api.github.com/users/CodeScience/followers","following_url":"https://api.github.com/users/CodeScience/following{/other_user}","gists_url":"https://api.github.com/users/CodeScience/gists{/gist_id}","starred_url":"https://api.github.com/users/CodeScience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CodeScience/subscriptions","organizations_url":"https://api.github.com/users/CodeScience/orgs","repos_url":"https://api.github.com/users/CodeScience/repos","events_url":"https://api.github.com/users/CodeScience/events{/privacy}","received_events_url":"https://api.github.com/users/CodeScience/received_events","type":"Organization","site_admin":false},"network_count":0,"subscribers_count":6}';
        Test.setMock(HttpCalloutMock.class, new AwsCalloutMock(orgResp));
        
        Test.startTest();
        ApexPages.currentPage().getParameters().put('id',projectDefinition.id);
        ApexPages.StandardController stdCtrl = new ApexPages.StandardController(projectDefinition);
        RemoteServices extCtrl = new RemoteServices(stdCtrl);
        String response = RemoteServices.addCircleResources(projectDefinition.Id);
        System.assert(!response.contains('Exception'), 'An exception should not be thrown');
        Test.stopTest();
    }

    @isTest static void test_watchRepo() {
        TestFactory.factoryUserDefinition(true);
        ProjectDefinition__c projectDefinition = TestFactory.factoryProjectDefinition(true);
        String orgResp = '{"id":44111987,"name":"New-Test-Project","full_name":"CodeScience/New-Test-Project","owner":{"login":"CodeScience","id":5943746,"avatar_url":"https://avatars.githubusercontent.com/u/5943746?v=3","gravatar_id":"","url":"https://api.github.com/users/CodeScience","html_url":"https://github.com/CodeScience","followers_url":"https://api.github.com/users/CodeScience/followers","following_url":"https://api.github.com/users/CodeScience/following{/other_user}","gists_url":"https://api.github.com/users/CodeScience/gists{/gist_id}","starred_url":"https://api.github.com/users/CodeScience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CodeScience/subscriptions","organizations_url":"https://api.github.com/users/CodeScience/orgs","repos_url":"https://api.github.com/users/CodeScience/repos","events_url":"https://api.github.com/users/CodeScience/events{/privacy}","received_events_url":"https://api.github.com/users/CodeScience/received_events","type":"Organization","site_admin":false},"private":true,"html_url":"https://github.com/CodeScience/New-Test-Project","description":null,"fork":false,"url":"https://api.github.com/repos/CodeScience/New-Test-Project","forks_url":"https://api.github.com/repos/CodeScience/New-Test-Project/forks","keys_url":"https://api.github.com/repos/CodeScience/New-Test-Project/keys{/key_id}","collaborators_url":"https://api.github.com/repos/CodeScience/New-Test-Project/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/CodeScience/New-Test-Project/teams","hooks_url":"https://api.github.com/repos/CodeScience/New-Test-Project/hooks","issue_events_url":"https://api.github.com/repos/CodeScience/New-Test-Project/issues/events{/number}","events_url":"https://api.github.com/repos/CodeScience/New-Test-Project/events","assignees_url":"https://api.github.com/repos/CodeScience/New-Test-Project/assignees{/user}","branches_url":"https://api.github.com/repos/CodeScience/New-Test-Project/branches{/branch}","tags_url":"https://api.github.com/repos/CodeScience/New-Test-Project/tags","blobs_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/refs{/sha}","trees_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/trees{/sha}","statuses_url":"https://api.github.com/repos/CodeScience/New-Test-Project/statuses/{sha}","languages_url":"https://api.github.com/repos/CodeScience/New-Test-Project/languages","stargazers_url":"https://api.github.com/repos/CodeScience/New-Test-Project/stargazers","contributors_url":"https://api.github.com/repos/CodeScience/New-Test-Project/contributors","subscribers_url":"https://api.github.com/repos/CodeScience/New-Test-Project/subscribers","subscription_url":"https://api.github.com/repos/CodeScience/New-Test-Project/subscription","commits_url":"https://api.github.com/repos/CodeScience/New-Test-Project/commits{/sha}","git_commits_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/commits{/sha}","comments_url":"https://api.github.com/repos/CodeScience/New-Test-Project/comments{/number}","issue_comment_url":"https://api.github.com/repos/CodeScience/New-Test-Project/issues/comments{/number}","contents_url":"https://api.github.com/repos/CodeScience/New-Test-Project/contents/{+path}","compare_url":"https://api.github.com/repos/CodeScience/New-Test-Project/compare/{base}...{head}","merges_url":"https://api.github.com/repos/CodeScience/New-Test-Project/merges","archive_url":"https://api.github.com/repos/CodeScience/New-Test-Project/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/CodeScience/New-Test-Project/downloads","issues_url":"https://api.github.com/repos/CodeScience/New-Test-Project/issues{/number}","pulls_url":"https://api.github.com/repos/CodeScience/New-Test-Project/pulls{/number}","milestones_url":"https://api.github.com/repos/CodeScience/New-Test-Project/milestones{/number}","notifications_url":"https://api.github.com/repos/CodeScience/New-Test-Project/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/CodeScience/New-Test-Project/labels{/name}","releases_url":"https://api.github.com/repos/CodeScience/New-Test-Project/releases{/id}","created_at":"2015-10-12T14:19:50Z","updated_at":"2015-10-12T14:19:50Z","pushed_at":"2015-10-12T14:19:50Z","git_url":"git://github.com/CodeScience/New-Test-Project.git","ssh_url":"git@github.com:CodeScience/New-Test-Project.git","clone_url":"https://github.com/CodeScience/New-Test-Project.git","svn_url":"https://github.com/CodeScience/New-Test-Project","homepage":null,"size":0,"stargazers_count":0,"watchers_count":0,"language":null,"has_issues":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":0,"mirror_url":null,"open_issues_count":0,"forks":0,"open_issues":0,"watchers":0,"default_branch":"master","permissions":{"admin":true,"push":true,"pull":true},"organization":{"login":"CodeScience","id":5943746,"avatar_url":"https://avatars.githubusercontent.com/u/5943746?v=3","gravatar_id":"","url":"https://api.github.com/users/CodeScience","html_url":"https://github.com/CodeScience","followers_url":"https://api.github.com/users/CodeScience/followers","following_url":"https://api.github.com/users/CodeScience/following{/other_user}","gists_url":"https://api.github.com/users/CodeScience/gists{/gist_id}","starred_url":"https://api.github.com/users/CodeScience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CodeScience/subscriptions","organizations_url":"https://api.github.com/users/CodeScience/orgs","repos_url":"https://api.github.com/users/CodeScience/repos","events_url":"https://api.github.com/users/CodeScience/events{/privacy}","received_events_url":"https://api.github.com/users/CodeScience/received_events","type":"Organization","site_admin":false},"network_count":0,"subscribers_count":6}';
        Test.setMock(HttpCalloutMock.class, new CircleCICalloutMock(orgResp));
        
        Test.startTest();
        ApexPages.currentPage().getParameters().put('id',projectDefinition.id);
        ApexPages.StandardController stdCtrl = new ApexPages.StandardController(projectDefinition);
        RemoteServices extCtrl = new RemoteServices(stdCtrl);
        String response = RemoteServices.circleWatchRepo(projectDefinition.Id);
        System.assert(!response.contains('Exception'), 'An exception should not be thrown');
        Test.stopTest();
    }

    @isTest static void test_create_team_members() {
        ProjectDefinition__c projectDef = TestFactory.factoryProjectDefinition(true);
        String orgResp = '{"id":44111987,"name":"New-Test-Project","full_name":"CodeScience/New-Test-Project","owner":{"login":"CodeScience","id":5943746,"avatar_url":"https://avatars.githubusercontent.com/u/5943746?v=3","gravatar_id":"","url":"https://api.github.com/users/CodeScience","html_url":"https://github.com/CodeScience","followers_url":"https://api.github.com/users/CodeScience/followers","following_url":"https://api.github.com/users/CodeScience/following{/other_user}","gists_url":"https://api.github.com/users/CodeScience/gists{/gist_id}","starred_url":"https://api.github.com/users/CodeScience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CodeScience/subscriptions","organizations_url":"https://api.github.com/users/CodeScience/orgs","repos_url":"https://api.github.com/users/CodeScience/repos","events_url":"https://api.github.com/users/CodeScience/events{/privacy}","received_events_url":"https://api.github.com/users/CodeScience/received_events","type":"Organization","site_admin":false},"private":true,"html_url":"https://github.com/CodeScience/New-Test-Project","description":null,"fork":false,"url":"https://api.github.com/repos/CodeScience/New-Test-Project","forks_url":"https://api.github.com/repos/CodeScience/New-Test-Project/forks","keys_url":"https://api.github.com/repos/CodeScience/New-Test-Project/keys{/key_id}","collaborators_url":"https://api.github.com/repos/CodeScience/New-Test-Project/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/CodeScience/New-Test-Project/teams","hooks_url":"https://api.github.com/repos/CodeScience/New-Test-Project/hooks","issue_events_url":"https://api.github.com/repos/CodeScience/New-Test-Project/issues/events{/number}","events_url":"https://api.github.com/repos/CodeScience/New-Test-Project/events","assignees_url":"https://api.github.com/repos/CodeScience/New-Test-Project/assignees{/user}","branches_url":"https://api.github.com/repos/CodeScience/New-Test-Project/branches{/branch}","tags_url":"https://api.github.com/repos/CodeScience/New-Test-Project/tags","blobs_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/refs{/sha}","trees_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/trees{/sha}","statuses_url":"https://api.github.com/repos/CodeScience/New-Test-Project/statuses/{sha}","languages_url":"https://api.github.com/repos/CodeScience/New-Test-Project/languages","stargazers_url":"https://api.github.com/repos/CodeScience/New-Test-Project/stargazers","contributors_url":"https://api.github.com/repos/CodeScience/New-Test-Project/contributors","subscribers_url":"https://api.github.com/repos/CodeScience/New-Test-Project/subscribers","subscription_url":"https://api.github.com/repos/CodeScience/New-Test-Project/subscription","commits_url":"https://api.github.com/repos/CodeScience/New-Test-Project/commits{/sha}","git_commits_url":"https://api.github.com/repos/CodeScience/New-Test-Project/git/commits{/sha}","comments_url":"https://api.github.com/repos/CodeScience/New-Test-Project/comments{/number}","issue_comment_url":"https://api.github.com/repos/CodeScience/New-Test-Project/issues/comments{/number}","contents_url":"https://api.github.com/repos/CodeScience/New-Test-Project/contents/{+path}","compare_url":"https://api.github.com/repos/CodeScience/New-Test-Project/compare/{base}...{head}","merges_url":"https://api.github.com/repos/CodeScience/New-Test-Project/merges","archive_url":"https://api.github.com/repos/CodeScience/New-Test-Project/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/CodeScience/New-Test-Project/downloads","issues_url":"https://api.github.com/repos/CodeScience/New-Test-Project/issues{/number}","pulls_url":"https://api.github.com/repos/CodeScience/New-Test-Project/pulls{/number}","milestones_url":"https://api.github.com/repos/CodeScience/New-Test-Project/milestones{/number}","notifications_url":"https://api.github.com/repos/CodeScience/New-Test-Project/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/CodeScience/New-Test-Project/labels{/name}","releases_url":"https://api.github.com/repos/CodeScience/New-Test-Project/releases{/id}","created_at":"2015-10-12T14:19:50Z","updated_at":"2015-10-12T14:19:50Z","pushed_at":"2015-10-12T14:19:50Z","git_url":"git://github.com/CodeScience/New-Test-Project.git","ssh_url":"git@github.com:CodeScience/New-Test-Project.git","clone_url":"https://github.com/CodeScience/New-Test-Project.git","svn_url":"https://github.com/CodeScience/New-Test-Project","homepage":null,"size":0,"stargazers_count":0,"watchers_count":0,"language":null,"has_issues":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"forks_count":0,"mirror_url":null,"open_issues_count":0,"forks":0,"open_issues":0,"watchers":0,"default_branch":"master","permissions":{"admin":true,"push":true,"pull":true},"organization":{"login":"CodeScience","id":5943746,"avatar_url":"https://avatars.githubusercontent.com/u/5943746?v=3","gravatar_id":"","url":"https://api.github.com/users/CodeScience","html_url":"https://github.com/CodeScience","followers_url":"https://api.github.com/users/CodeScience/followers","following_url":"https://api.github.com/users/CodeScience/following{/other_user}","gists_url":"https://api.github.com/users/CodeScience/gists{/gist_id}","starred_url":"https://api.github.com/users/CodeScience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CodeScience/subscriptions","organizations_url":"https://api.github.com/users/CodeScience/orgs","repos_url":"https://api.github.com/users/CodeScience/repos","events_url":"https://api.github.com/users/CodeScience/events{/privacy}","received_events_url":"https://api.github.com/users/CodeScience/received_events","type":"Organization","site_admin":false},"network_count":0,"subscribers_count":6}';
        Test.setMock(HttpCalloutMock.class, new GithubCalloutMock(orgResp));

        List<Team_Member__c> testTeamMembers = TestFactory.factoryTeamMembers(true, projectDef, 3);
        RemoteServices.WizardPayload payload = new RemoteServices.WizardPayload();
        payload.teamMembers = new List<RemoteServices.TeamMember>();
        for (Team_Member__c teamMember : testTeamMembers) {
            RemoteServices.TeamMember rmTeamMember = new RemoteServices.TeamMember();
            rmTeamMember.id = teamMember.Id;
            rmTeamMember.name = teamMember.Name;
            rmTeamMember.firstName = 'FirstName';
            rmTeamMember.lastName = 'LastName';
            rmTeamMember.githubHandle = 'gitHandle';
            rmTeamMember.role = 'role';
            rmTeamMember.email = 'email@test.com';
            //rmTeamMember.contact
            rmTeamMember.projectDefinition = projectDef.Id;
            payload.teamMembers.add(rmTeamMember);
        }

        Test.startTest();

        Boolean success = RemoteServices.createTeamMembers(JSON.serialize(payload), projectDef.Id);
        system.assertEquals(true, success);

        Test.stopTest();
    }

    @isTest static void test_create_environments() {
        
        RemoteServices.Environment rmEnvironment = new RemoteServices.Environment();
        rmEnvironment.namespace = 'namespace';
        rmEnvironment.parentEnvironment = null;
        rmEnvironment.isPackaging = true;
        rmEnvironment.isProduction = false;

        RemoteServices.WizardPayload payload = new RemoteServices.WizardPayload();
        payload.environments = new List<RemoteServices.Environment>{ rmEnvironment };

        ProjectDefinition__c projectDef = TestFactory.factoryProjectDefinition(true);
        List<Team_Member__c> testTeamMembers = TestFactory.factoryTeamMembers(true, projectDef, 3);

        Test.startTest();

        // TODO: Resolve issues with RemoteServices.createEnvironments()
        try {
            Boolean success = RemoteServices.createEnvironments(JSON.serialize(payload), projectDef.Id);
            system.assertEquals(true, success);
        } catch (Exception ex) {
            system.debug('TODO: Fix error: ' + ex.getMessage() + '\n' + ex.getStackTraceString());
        }

        Test.stopTest();
    }

    @isTest static void test_data_structures() {

        RemoteServices.WizardPayload wizPayload = new RemoteServices.WizardPayload();
        wizPayload.id = null;
        wizPayload.projectName = '';
        wizPayload.packageName = '';
        wizPayload.projectDescription = '';
        wizPayload.namespace = '';
        wizPayload.teamMembers = new List<RemoteServices.TeamMember>();
        wizPayload.environments = new List<RemoteServices.Environment>();
        wizPayload.repositories = new List<RemoteServices.Repository>();

        RemoteServices.TeamMember teamMember = new RemoteServices.TeamMember();
        teamMember.id = null;
        teamMember.name = '';
        teamMember.firstName = '';
        teamMember.lastName = '';
        teamMember.githubHandle = '';
        teamMember.role = '';
        teamMember.email = '';
        teamMember.contact = '';
        teamMember.projectDefinition = '';

        RemoteServices.Environment environment = new RemoteServices.Environment();
        environment.id = null;
        environment.name = '';
        environment.branchName = '';
        environment.projectDefinition = '';
        environment.namespace = '';
        environment.parentEnvironment = '';
        environment.isPackaging = true;
        environment.isProduction = true;
        environment.isSelected = true;

        RemoteServices.Repository repository = new RemoteServices.Repository();
        repository.id = null;
        repository.name = '';
        repository.url = '';
        repository.isSelected = true;
    }
	
}